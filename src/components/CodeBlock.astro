---
export interface Props {
  code: string;
  language?: string;
  title?: string;
  showLineNumbers?: boolean;
}

const { code, language = 'bash', title, showLineNumbers = false } = Astro.props;

// Simple syntax highlighting classes based on language
const getLanguageClass = (lang: string) => {
  const classes: Record<string, string> = {
    bash: 'language-bash',
    javascript: 'language-js',
    typescript: 'language-ts',
    python: 'language-python',
    yaml: 'language-yaml',
    json: 'language-json',
  };
  return classes[lang] || 'language-text';
};
---

<div class="code-block-wrapper mb-4">
  {title && (
    <div class="code-block-title bg-bg-card border border-border-default border-b-0 py-2 px-4 rounded-t-lg">
      <span class="text-text-secondary text-sm font-medium">{title}</span>
    </div>
  )}
  <div class="code-block relative bg-bg-card border border-border-default rounded-lg overflow-hidden" class:list={[title && 'rounded-t-none']}>
    <button
      class="copy-button absolute top-3.5 right-4 bg-bg-deep rounded text-text-secondary hover:text-lime-green transition-colors text-base z-10 focus:outline-none"
      data-code={code}
      aria-label="Copy code to clipboard"
    >
      <i class="fa-solid fa-copy"></i>
    </button>
    <pre class="block m-0 p-4 pr-28 min-h-12 overflow-x-auto text-sm bg-transparent"><code class={`${getLanguageClass(language)} block font-mono text-sm leading-relaxed text-text-primary`}>{code}</code></pre>
  </div>
</div>

<script>
  // Client-side code for copy functionality
  document.addEventListener('DOMContentLoaded', () => {
    const copyButtons = document.querySelectorAll('.copy-button');

    copyButtons.forEach((button) => {
      button.addEventListener('click', async () => {
        const code = button.getAttribute('data-code');
        const icon = button.querySelector('i');

        if (!code || !icon) return;

        try {
          await navigator.clipboard.writeText(code);

          // Change icon to checkmark
          icon.className = 'fa-solid fa-check';
          button.classList.add('text-lime-green');

          // Reset after 2 seconds
          setTimeout(() => {
            icon.className = 'fa-solid fa-copy';
            button.classList.remove('text-lime-green');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy code:', err);
          icon.className = 'fa-solid fa-xmark';
          setTimeout(() => {
            icon.className = 'fa-solid fa-copy';
          }, 2000);
        }
      });
    });
  });
</script>
